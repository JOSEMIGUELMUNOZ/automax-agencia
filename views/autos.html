 <!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vehículos - AutoMax</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1>Auto<span>Max</span></h1>
                </div>
                <nav>
                    <ul>
                        <li><a href="/">Inicio</a></li>
                        <li><a href="/autos" class="active">Vehículos</a></li>
                        <li><a href="/citas">Citas</a></li>
                        <li><a href="/enganche">Financiamiento</a></li>
                        <li><a href="/perfil">Mi Perfil</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <div class="container" style="margin-top: 2rem;">
        <section class="section">
            <h2>Nuestros Vehículos</h2>
            
            <!-- Filtros -->
            <div class="form-container" style="margin-bottom: 2rem;">
                <h3 style="margin-bottom: 1rem; color: #2c3e50;">Filtrar Vehículos</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="filtro-marca">Marca:</label>
                        <select id="filtro-marca">
                            <option value="">Todas las marcas</option>
                            <option value="Toyota">Toyota</option>
                            <option value="Honda">Honda</option>
                            <option value="Ford">Ford</option>
                            <option value="Chevrolet">Chevrolet</option>
                            <option value="Nissan">Nissan</option>
                            <option value="Volkswagen">Volkswagen</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filtro-tipo">Tipo:</label>
                        <select id="filtro-tipo">
                            <option value="">Todos los tipos</option>
                            <option value="Sedan">Sedan</option>
                            <option value="SUV">SUV</option>
                            <option value="Pickup">Pickup</option>
                            <option value="Hatchback">Hatchback</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="filtro-precio-min">Precio mínimo:</label>
                        <input type="number" id="filtro-precio-min" placeholder="Ej: 300000">
                    </div>
                    <div class="form-group">
                        <label for="filtro-precio-max">Precio máximo:</label>
                        <input type="number" id="filtro-precio-max" placeholder="Ej: 800000">
                    </div>
                </div>
                <button onclick="aplicarFiltros()" class="btn" style="width: 100%;">Aplicar Filtros</button>
            </div>

            <!-- Resultados -->
            <div id="resultados-info" style="margin-bottom: 1rem; font-weight: bold; color: #666;"></div>
            
            <div id="autos-container" class="autos-grid">
                <div class="loading">Cargando vehículos...</div>
            </div>
        </section>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2024 AutoMax - Agencia de Autos Premium. Todos los derechos reservados.</p>
            <p>📧 contacto@automax.com | 📞 (899) 123-4567 | 📍 Reynosa, Tamaulipas</p>
        </div>
    </footer>

    <script src="/js/main.js"></script>
    <script>
        let todosLosAutos = [];
        let autosActuales = [];

        document.addEventListener('DOMContentLoaded', function() {
            cargarAutos();
        });

        async function cargarAutos() {
            try {
                const response = await fetch('/api/autos');
                todosLosAutos = await response.json();
                autosActuales = [...todosLosAutos];
                mostrarAutos(autosActuales);
                actualizarResultados();
            } catch (error) {
                console.error('Error al cargar autos:', error);
                document.getElementById('autos-container').innerHTML = 
                    '<div class="alert alert-error">Error al cargar los vehículos. Intenta recargar la página.</div>';
            }
        }

        function mostrarAutos(autos) {
            const container = document.getElementById('autos-container');
            
            if (autos.length === 0) {
                container.innerHTML = '<div class="alert alert-error">No se encontraron vehículos que coincidan con los filtros seleccionados.</div>';
                return;
            }

            container.innerHTML = '';
            
            autos.forEach(auto => {
                const autoCard = createAutoCard(auto);
                container.appendChild(autoCard);
            });
        }

        function createAutoCard(auto) {
            const card = document.createElement('div');
            card.className = 'auto-card';
            card.innerHTML = `
                <img src="${auto.imagen}" alt="${auto.marca} ${auto.modelo}" loading="lazy">
                <div class="auto-info">
                    <h3>${auto.marca} ${auto.modelo} ${auto.año}</h3>
                    <div class="precio">$${auto.precio.toLocaleString()}</div>
                    <div class="specs">
                        <div class="spec-item">
                            <span><strong>Tipo:</strong></span>
                            <span>${auto.tipo}</span>
                        </div>
                        <div class="spec-item">
                            <span><strong>Combustible:</strong></span>
                            <span>${auto.combustible}</span>
                        </div>
                        <div class="spec-item">
                            <span><strong>Transmisión:</strong></span>
                            <span>${auto.transmision}</span>
                        </div>
                        <div class="spec-item">
                            <span><strong>Año:</strong></span>
                            <span>${auto.año}</span>
                        </div>
                    </div>
                    <div class="auto-actions">
                        <button onclick="calcularEnganche(${auto.id})" class="btn btn-small">Calcular Enganche</button>
                        <button onclick="agendarCita(${auto.id})" class="btn btn-small btn-secondary">Agendar Cita</button>
                    </div>
                </div>
            `;
            return card;
        }

        function aplicarFiltros() {
            const marca = document.getElementById('filtro-marca').value;
            const tipo = document.getElementById('filtro-tipo').value;
            const precioMin = document.getElementById('filtro-precio-min').value;
            const precioMax = document.getElementById('filtro-precio-max').value;

            autosActuales = todosLosAutos.filter(auto => {
                let cumpleFiltros = true;

                if (marca && auto.marca !== marca) {
                    cumpleFiltros = false;
                }

                if (tipo && auto.tipo !== tipo) {
                    cumpleFiltros = false;
                }

                if (precioMin && auto.precio < parseInt(precioMin)) {
                    cumpleFiltros = false;
                }

                if (precioMax && auto.precio > parseInt(precioMax)) {
                    cumpleFiltros = false;
                }

                return cumpleFiltros;
            });

            mostrarAutos(autosActuales);
            actualizarResultados();
        }

        function actualizarResultados() {
            const total = autosActuales.length;
            const mensaje = total === 1 ? '1 vehículo encontrado' : `${total} vehículos encontrados`;
            document.getElementById('resultados-info').textContent = mensaje;
        }

        function calcularEnganche(autoId) {
            window.location.href = `/enganche?auto=${autoId}`;
        }

        function agendarCita(autoId) {
            window.location.href = `/citas?auto=${autoId}`;
        }

        // Funciones para limpiar filtros
        function limpiarFiltros() {
            document.getElementById('filtro-marca').value = '';
            document.getElementById('filtro-tipo').value = '';
            document.getElementById('filtro-precio-min').value = '';
            document.getElementById('filtro-precio-max').value = '';
            aplicarFiltros();
        }
    </script>
</body>
</html>
